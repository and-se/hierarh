<!DOCTYPE html>
<head>

<meta charset="utf8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{article.header}}</title>

<link rel="stylesheet" type="text/css" href="/static/simple.css" >
<link rel="stylesheet" type="text/css" href="/static/style.css" >


</head>

<body>
    <header>
        <nav>
          <ul class="collections">
              <li><a class="{{'current' if item_type=='cafedra'}}" href="/cafedra">Кафедры</a></li>
              <li><a class="{{'current' if item_type=='episkop'}}" href="/episkop">Епископы</a></li>
          </ul>
        </nav>
    </header>

    <main>
    {% autoescape false %}
    <h1>{{article.header}}</h1>
    {%if article.text %}
    <p>{{article.text}}</p>
    {% endif %}

    <table class="episkops">
    {% for ep in article.episkops %}
    <tr>
        {%if ep is string%}
        <th colspan="3" class="episkops_header">{{ep}}</th>
        {% else %}
        <td>
            {% if ep.inexact %}
                {{'('}}
            {% endif %}
            {{ep.begin_dating or ''}}
        </td>
        <td>{{ep.end_dating or ''}}</td>
        <td>
            {%if ep.episkop_id %}
                <a href="/episkop/{{ep.episkop_id}}">{{ep.episkop}}</a>
            {% else %}
                {{ep.who}}
            {% endif %}
            {% if ep.inexact %}
                    {{')'}}
            {% endif %}
        </td>
        {% endif %}
    </tr>
    {% endfor %}
    </table>

    <ul class="notes">
    {%for note in article.notes%}
    <li>
        <p>
            <span class="note_start" id="note_{{note.num}}">{{note.num}}</span>
            {{note.text}}
        </p>
    </li>
    {%endfor%}
    </ul>

    {% endautoescape %}
    </main>
    <!--<script>
        var elements = document.getElementsByClassName("note");

        var go_to_note = function(event) {
            el = document.getElementById("note_" + this.dataset.note)
            if (el) {
                event.preventDefault();
                el.scrollIntoView();
                var back = this;
                el.parentElement.setAttribute('title', "Нажмите на номер ссылки для возврата обратно");

                var go_back = function() {
                    el.parentElement.removeAttribute('title');
                    back.scrollIntoView();
                }

                el.addEventListener('click', go_back, { once: true, capture: false});
            }
        }

        for (var i = 0; i < elements.length; i++) {
            elements[i].addEventListener('click', go_to_note, false);
        }
    </script>-->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Получаем все ссылки в таблице
            var links = document.querySelectorAll('.episkops a');

            // Функция для обработки клика по ссылке
            var handleLinkClick = function(event) {
                event.preventDefault();

                // Получаем ID сноски из href ссылки
                var noteId = this.getAttribute('href').split('/').pop();
                var noteElement = document.getElementById('note_' + noteId);

                // Проверяем, существует ли сноска
                if (noteElement) {
                    // Проверяем, существует ли уже строка со сноской
                    var existingRow = this.closest('tr').nextElementSibling;
                    if (existingRow && existingRow.classList.contains('note-row')) {
                        // Если строка со сноской уже существует, удаляем ее
                        existingRow.remove();
                    } else {
                        // Если строки со сноской нет, создаем ее

                        // Клонируем элемент сноски
                        var clonedNote = noteElement.cloneNode(true);

                        // Создаем новую строку и ячейку для сноски
                        var newRow = document.createElement('tr');
                        newRow.classList.add('note-row'); // Добавляем класс для идентификации
                        var newCell = document.createElement('td');
                        newCell.colSpan = 3; // Растягиваем ячейку на все колонки
                        newCell.appendChild(clonedNote);

                        newRow.appendChild(newCell);

                        // Вставляем новую строку после текущей строки, в которой находится ссылка
                        this.closest('tr').after(newRow);
                    }
                }
            };

            // Добавляем обработчик событий на каждую ссылку
            links.forEach(function(link) {
                link.addEventListener('click', handleLinkClick);
            });
        });
    </script>

</body>
